// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

generator typescriptInterfaces {
  provider = "prisma-generator-typescript-interfaces"
  output = "../../../../packages/types/src/prisma-types.ts"
  modelType = "type"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProcessingStatus {
  PENDING // Waiting in queue, file already downloaded and saved to back-end server.
  PROCESSING // File popped from queue, begin processing.
  SAVING //File being sent to s3.
  COMPLETED //File saved to s3 and data can now be accessed by the user. Waiting for verification after completion.
  FAILED //File failed during one of these steps.
}

enum VerificationStatus {
  UNVERIFIED
  VERIFIED
}

enum InvoiceType {
  ACCOUNTS_PAYABLE
  ACCOUNTS_RECEIVABLE
}

enum PaymentStatus {
  PAID
  UNPAID
}

model Invoice {
  id                            Int                @id @default(autoincrement())
  createdAt                     DateTime           @default(now())
  updatedAt                     DateTime           @updatedAt

  fileName                      String             @unique
  originalFileName              String
  mimeType                      String
  filePath                      String
  currentProcessingStatus       ProcessingStatus   @default(PENDING)
  verificationStatus            VerificationStatus @default(UNVERIFIED)

  projectName                   String?
  invoiceType                   InvoiceType?
  paymentStatus                 PaymentStatus      @default(UNPAID)

  CustomerName                  String?
  CustomerId                    String?
  PurchaseOrder                 String?
  InvoiceId                     String?
  InvoiceDate                   DateTime?
  DueDate                       DateTime?

  VendorName                    String?
  VendorAddress                 String?
  VendorAddressRecipient        String?

  CustomerAddress               String?
  CustomerAddressRecipient      String?

  BillingAddress                String?
  BillingAddressRecipient       String?

  ShippingAddress               String?
  ShippingAddressRecipient      String?

  SubTotal                      String?
  TotalDiscount                 String?
  TotalTax                      String?
  InvoiceTotal                  Float?
  AmountDue                     String?
  PreviousUnpaidBalance         String?

  RemittanceAddress             String?
  RemittanceAddressRecipient    String?

  ServiceAddress                String?
  ServiceAddressRecipient       String?

  ServiceStartDate              String?
  ServiceEndDate                String?

  VendorTaxId                   String?
  CustomerTaxId                 String?
  PaymentTerm                   String?

  user      User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int

  @@index([userId, verificationStatus, currentProcessingStatus], name: "idx_invoice_user_verif_proc")
  @@index([userId, createdAt], name: "idx_invoice_user_created")
}

enum Role {
  USER
  ADMIN
}

model User{
  id           Int        @id @default(autoincrement())
  firstName    String 
  username     String     @unique
  password     String
  role         Role       @default(USER)
  createdAt    DateTime   @default(now())
  refreshToken String?

  invoices            Invoice[]
}